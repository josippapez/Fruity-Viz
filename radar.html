<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>Fruity Radar Chart</title>
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
      integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay"
      crossorigin="anonymous"
    />
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <link href="./css/radar.css" rel="stylesheet" type="text/css" />
    <link href="./css/style.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div class="graphs">
      <nav class="nav-icons">
        <a href="index.html" class="menu-dark">
          <span>Parallel Coordinates</span>
          <i class="fab fa-think-peaks"></i>
        </a>
        <a href="radar.html" class="menu-red">
          <span>Radar Chart</span>
          <i class="fas fa-crosshairs"></i>
        </a>
      </nav>
      <hr />
      <div class="container-flex">
        <div class="row">
          <!-- Informacije o prvom voću-->
          <div id="fruit1info" class="column column-4">
            <div class="searchBox">
              <div class="search">
                <p class="searchLabel">SEARCH:</p>
                <input
                  list="fruit1Datalist"
                  name="fruit1Search"
                  id="fruit1Input"
                  class="column"
                />
                <datalist id="fruit1Datalist"></datalist>
              </div>

            </div>
          </div>
          <!-- Informacije o drugom voću -->
          <div id="fruit2info" class="column column-4">
            <div class="search">
              <p class="searchLabel">SEARCH:</p>
              <input
                list="fruit2Datalist"
                name="fruit2Search"
                id="fruit2Input"
                class="column"
              />
              <datalist id="fruit2Datalist"></datalist>
            </div>

          </div>
        </div>
        <!-- Radarski graf -->
        <div class="radarChart column column-6"></div>
      </div>
    </div>
    <a class="butn resetScale" id="fruit1SearchButton" onclick="">SUBMIT</a>
  </body>
  <script src="./scripts/libs/radarchart.js"></script>
  <script src="./scripts/radar.js"></script>
  <script>
    // Dohvaćanje ID-ja iz URL-a
    const urlParams = new URLSearchParams(window.location.search);
    var fruitId = urlParams.get("id");

    // Podaci koji će se proslijediti RadarChart funkciji
    var fruitData = [[], []];
    var maxValue = 0;

    // Osi na radarskom grafu
    const allowedKeys = [
      "carbohydrates g",
      "protein g",
      "fat g",
      "calories",
      "sugar g",
    ];

    // Dohvaćanje gumbova i polja za pretragu
    var fruit1input = document.querySelector("#fruit1Input");
    var fruitSubmitButton = document.querySelector("#fruit1SearchButton");

    var fruit2input = document.querySelector("#fruit2Input");
    var fruit2SearchButton = document.querySelector("#fruit2SearchButton");

    d3.csv("./data/fruits.csv", function (error, data) {
      // Popunjavanje vrijednosti datalist elementa svim imenima fruita iz skupa podataka
      d3.select("#fruit1Datalist")
        .selectAll("option")
        .data(data)
        .enter()
        .append("option")
        .attr("value", function (d) {
          return d.name;
        });
      d3.select("#fruit2Datalist")
        .selectAll("option")
        .data(data)
        .enter()
        .append("option")
        .attr("value", function (d) {
          return d.name;
        });

      // Kada se klikne na button, dohvati se ID fruita pomoću upisanog imena i iscrtaju
      // se svi elementi za tog fruita
      fruitSubmitButton.addEventListener("click", function () {
        fruitId = findfruitByName(fruit1input.value, data);
        for (key in allowedKeys) {
          if (
            maxValue <
            Number(
              data.find((element) => element.name == fruitId.name)[
                allowedKeys[key]
              ]
            )
          ) {
            maxValue = Number(
              data.find((element) => element.name == fruitId.name)[
                allowedKeys[key]
              ]
            );
          }
        }
        drawAll(data, fruitId, 1, maxValue);
        fruitId = findfruitByName(fruit2input.value, data);
        for (key in allowedKeys) {
          if (
            maxValue <
            Number(
              data.find((element) => element.name == fruitId.name)[
                allowedKeys[key]
              ]
            )
          ) {
            maxValue = Number(
              data.find((element) => element.name == fruitId.name)[
                allowedKeys[key]
              ]
            );
          }
        }
        drawAll(data, fruitId, 2, maxValue);
        maxValue = 0;
      });
    });
  </script>
</html>
